# User(用户表)

> 注意：在整个用户系统中，email 是唯一用于登录的标识，必须是全局唯一的。实名认证过的用户必须同时校验 email 和 mobile 的真实性！
> 因此在用户注册时需要查询是否有重复的 email；实名认证过程中要确保 email 和 mobile 都被校验。

> 我们将系统设计为只能通过**`email`**登录，因此 User 表中的 `username` 字段没有实质意义，但 strapi 的默认
> 注册流程中又必须这个字段，因此将此字段默认设置为与用户注册时所用的 `email` 一致。

用户注册流程：

1、填写邮箱、密码、邮箱验证码
2、系统校验邮箱地址是否合法且 User 表中不存在
3、在 User 表中创建用户，其中 `username`、`nickname` 字段与 `email` 字段相同。

`nickname` 代表用户的昵称或简称，用于显示在后台的右上角，主要作为用户对自己的当前账号的一个清晰标识。初始值与 `email` 字段相同。
用户信息详情页中可以允许用户修改 `nickname`，且不用查询系统中是否有重复。`nickname` 字段的长度限定不超过20个字符。

`nickname` 显示时，根据设计，如果太长的话用 CSS 隐去后面太长的部分。


| Name                    | Type             | Relation With | Description                         |
|-------------------------|------------------|---------------|-------------------------------------|
| username                | Text             |               | 用户名。默认同邮箱                           |
| nickname                | Text             |               | 用户昵称。                           |
| email                   | Email            |               | 邮箱。用于登录                                  |
| provider                | Text             |               | 暂时不用                                |
| password                | Password         |               | 密码                                  |
| resetPasswordToken      | Text             |               | 重置密码的 token                         |
| confirmationToken       | Text             |               | 邮箱确认码                               |
| confirmed               | Boolean          |               | 邮箱是否已确认                             |
| blocked                 | Boolean          |               | 是否被禁                                |
| role                    | Relation         | Role          | 角色。默认值为 Public，实名认证后为 Authenticated |
| avatar                  | Media(single)    |               | 头像                                  |
| mobile                  | Text(short text) |               | 手机号                                 |
| mobileConfirmed         | Boolean          |               | 手机号是否已确认                            |
| mobileConfirmationToken | Text(short text) |               | 手机号确认码                              |
| amount                  | Number(float)    |               | 充值总额                                |
| balance                 | Number(float)    |               | 余额                                  |
| invoiceBalance          | Number(float)    |               | 可开票金额                               |
| signInLogs              | Relation         | Sign In Log   | 关联登录日志                              |
| tickets                 | Relation         | Ticket        | 关联工单                                |
| invoices                | Relation         | Invoice       | 关联发票表                               |
| invoiceTitles           | Relation         | Invoice Title | 关联发票抬头表                             |
| tasks                   | Relation         | Task          | 关联消息队列表                             |
| cdnPackages             | Relation         | CDN Package   | 关联 CDN 资源包表                         |
| orders                  | Relation         | Order         | 关联发票抬头表                             |
| bareMetalServers        | Relation         | Bare Metal Server         | 物理服务器                             |
| cdnBalance              | Number           |               | CDN 流量余额，单位 byte                                 |
