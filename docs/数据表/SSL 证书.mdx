# Certificate（SSL 证书）

| Name    |   Type           | Relation With |Description
| ------- | ---------------- | ----------- | ----------- |
| key     | Text             |             | 私钥内容 |
| content | Text             |             | 证书内容 |
| name    | Text(short text) |             | 证书名称（可以为空） |
| user    | Relation         | User        |  |
| config  | JSON             |             | 上游返回的证书相关信息 |

## 添加证书

用户添加证书时，`key` 和 `content` 字段是必填项，`config` 字段由于是上游返回的信息，不可由用户填写。

在添加证书页面，需要给用户列出所有域名，以便用户将证书和域名关联，然后调用上游接口设置并启用证书。

成功调用上游接口添加证书之后，需要消息队列根据上游返回的 `CertificateId` 查询一下证书的详细信息并回填到 `config` 字段，后续前端页面展示证书详细信息时需从 `config` 字段获取。

## 更新证书

用户更新证书时，根据金山的接口（https://docs.ksyun.com/documents/259?type=3），是上传新证书替换旧证书，并返回新证书的新 ID，因此，我们在前端页面上和添加新证书类似，只是预先把旧证书内容填充到对应字段，由用户修改并调用上游接口更新。

注意，证书关联的域名需要从 `config` 字段获取，不允许用户增、删域名。

此处仅是对证书的更新。

## 删除证书

根据上游接口直接调用接口删除即可，在本地数据库

